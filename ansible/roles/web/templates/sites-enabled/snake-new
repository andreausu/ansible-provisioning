server {
	listen 80;

	server_name  {{ snake_domain }};
{% if dev %}
	root         /var/www/snake_new/web;
	{% else %}
	root         /var/www/snake_new/current/web;
{% endif %}

	access_log   /var/log/nginx/{{ snake_domain }}.access.log  main;
	error_log    /var/log/nginx/{{ snake_domain }}.error.log error;

	location ~* \.(jpg|jpeg|gif|css|png|js|ico)$ {
		expires 35d;
	}

	location / {
	{% if dev %}
		index app_dev.php;
		try_files $uri $uri/ /app_dev.php?$query_string;
	{% else %}
		index app.php;
		try_files $uri $uri/ /app.php?$query_string;
	{% endif %}
	}

	location ~ ^/(app_dev|app)\.php$ {
		try_files            $uri =404;
		fastcgi_pass         unix:/tmp/{{ snake_domain }}.php-fpm.sock;
		fastcgi_buffer_size  32k;
		fastcgi_buffers      32 8k;
	}
}
